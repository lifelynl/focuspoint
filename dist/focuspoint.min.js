!function(e){"use strict";var y={isDOMElement:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},areDOMElements:function(e){try{if("object"!=typeof e||!Array.isArray(e))throw"arr is not an array.";return e.every(function(e){return y.isDOMElement(e)})}catch(e){return new h.InternalError("Helpers.areDOMElements()",e)}},bound:function(e,t,n){try{if("number"!=typeof e)throw"value is not a number.";if("number"!=typeof t)throw"min is not a number.";if("number"!=typeof n)throw"max is not a number.";return Math.max(t,Math.min(e,n))}catch(e){return new h.InternalError("Helpers.bound()",e)}},getPositionInElementByEvent:function(e,t,n,o,r){try{if(!y.isDOMElement(e))throw"elm is not a DOM element.";if(void 0===o)throw"event is undefined.";if(r){if(void 0!==o.touches&&o.touches.length<=0)throw"no touches found in event.";if("number"!=typeof o.touches[0].pageX)throw"event.touches[0].pageX not found.";if("number"!=typeof o.touches[0].pageY)throw"event.touches[0].pageY not found."}else{if("number"!=typeof o.pageX)throw"event.pageX not found.";if("number"!=typeof o.pageY)throw"event.pageY not found."}var i=e.getBoundingClientRect(),s=(r?o.touches[0]:o).pageX-n.x,u=(r?o.touches[0]:o).pageY-n.y,a=s/i.width,c=u/i.height,f=t.x+a,m=t.y+c;return{x:y.bound(f,0,1),y:y.bound(m,0,1)}}catch(e){return new h.InternalError("Helpers.getPositionInElementByEvent()",e)}},setBackgroundPositionToElm:function(e,t,n){try{if(!y.isDOMElement(e))throw"elm is not a DOM element.";if("number"!=typeof t)throw"x is not a number.";if("number"!=typeof n)throw"y is not a number.";if(t<0||1<t)throw"x must be a number between 0 and 1.";if(n<0||1<n)throw"y must be a number between 0 and 1.";var o=y.bound(t,0,1),r=y.bound(n,0,1),i=100*o+"%",s=100*r+"%";return e.style.backgroundPosition="top "+s+" left "+i,!0}catch(e){return new h.InternalError("Helpers.setBackgroundPositionToElm()",e)}},setPositionToButtonElement:function(e,t,n){try{if(!y.isDOMElement(e))throw"elm is not a DOM element.";if("number"!=typeof t)throw"x is not a number.";if("number"!=typeof n)throw"y is not a number.";if(t<0||1<t)throw"x must be a number between 0 and 1.";if(n<0||1<n)throw"y must be a number between 0 and 1.";return e.style.left=100*t+"%",e.style.top=100*n+"%",!0}catch(e){return new h.InternalError("Helpers.setPositionToButtonElement()",e)}},initializeDrag:function(n,e,o,r,i,s){try{if(!y.isDOMElement(n))throw"container_elm is not a DOM element";if(!y.isDOMElement(e))throw"button_elm is not a DOM element";if("object"!=typeof o)throw"current coordinates placeholder is not an object";if("object"!=typeof r)throw"eventSystem is not an object";if("boolean"!=typeof i)throw"hide_cursor is not a boolean";if(i&&"string"!=typeof s)throw"no_cursor_class is not a string";var u,a={},c={},t=function(e,t){"end"!==e&&("start"===e&&(u?(a.x=t.touches[0].pageX,a.y=t.touches[0].pageY):(a.x=t.pageX,a.y=t.pageY),c.x=o.x,c.y=o.y),(t=y.getPositionInElementByEvent(n,c,a,t,u)).x===o.x&&t.y===o.y||(o.x=t.x,o.y=t.y,r.applyEvent("change",[o.x,o.y]))),r.applyEvent("drag:"+e,[o.x,o.y]),i&&("start"===e?n.classList.add(s):"end"===e&&n.classList.remove(s))},f=function(e){e.preventDefault(),u=void 0!==e.touches,t("start",e),document.addEventListener(u?"touchmove":"mousemove",m),document.addEventListener(u?"touchend":"mouseup",l)},m=function(e){e.preventDefault(),window.requestAnimationFrame(function(){t("move",e)})},l=function(e){e.preventDefault(),t("end",e),document.removeEventListener("touchmove",m),document.removeEventListener("touchend",l),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",l)};return e.addEventListener("touchstart",f),e.addEventListener("mousedown",f),function(){e.removeEventListener("touchstart",f),document.removeEventListener("touchmove",m),document.removeEventListener("touchend",l),e.removeEventListener("mousedown",f),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",l)}}catch(e){return new h.InternalError("Helpers.initializeDrag()",e)}},attachViews:function(n,e,t){try{if(Array.isArray(n)&&!y.areDOMElements(n))throw"view_elm is an array, but not all items are DOM elements";if(!(Array.isArray(n)||"object"==typeof n&&y.isDOMElement(n)))throw"view_elm is not a DOM element";if("object"!=typeof e)throw"current is not an object";if("number"!=typeof e.x)throw"current.x is not a number";if("number"!=typeof e.y)throw"current.y is not a number";if("function"!=typeof t)throw"event_binder is not a function";var o=function(e,t,n){Array.isArray(e)?e.forEach(function(e){y.setBackgroundPositionToElm(e,t,n)}):y.setBackgroundPositionToElm(e,t,n)};return o(n,e.x,e.y),t("change",function(e,t){o(n,e,t)})}catch(e){return new h.InternalError("Helpers.attachViews()",e)}},attachButton:function(n,e,t){try{if(!y.isDOMElement(n))throw"button_elm is not a DOM element";if("object"!=typeof e)throw"current is not an object";if("number"!=typeof e.x)throw"current.x is not a number";if("number"!=typeof e.y)throw"current.y is not a number";if("function"!=typeof t)throw"event_binder is not a function";return y.setPositionToButtonElement(n,e.x,e.y),t("change",function(e,t){y.setPositionToButtonElement(n,e,t)})}catch(e){return new h.InternalError("Helpers.attachButton()",e)}}},h={ApiError:function(e,t){return console.error("Focuspoint error in "+e+":",t),{error:!0,internal:!1,context:e,message:t}},InternalError:function(e,t){return console.error("Focuspoint internal error in "+e+":",t),{error:!0,internal:!0,context:e,message:t}},Current:function(e,t){try{if("number"!=typeof e)throw"x is not a number.";if("number"!=typeof t)throw"y is not a number.";if(e<0||1<e)throw"x must be a number between 0 and 1.";if(t<0||1<t)throw"y must be a number between 0 and 1.";return{x:e,y:t}}catch(e){return new h.InternalError("Library.Current()",e)}},EventSystem:function(){var r=this;r.possibleEvents=["drag:start","drag:move","drag:end","change"],r.increment=0,r.callbacks=[],r.applyEvent=function(n,o){try{if(-1===r.possibleEvents.indexOf(n))throw'Event "'+n+'" not found.';if(o=o||[],!Array.isArray(o))throw"Arguments is not an array.";r.callbacks.forEach(function(e,t){if(e.event===n){if("function"!=typeof e.handler)throw"Callback is not a function.";e.handler.apply(window,o)}})}catch(e){return new h.InternalError("Library.EventSystem().applyEvent()",e)}},r.register=function(e,t){try{if("string"!=typeof e)throw"event is not a string";if(-1===r.possibleEvents.indexOf(e))throw'event "'+e+'" does not exist';if("function"!=typeof t)throw"handler is not a function";r.increment++;var n=r.increment,o={id:n,event:e,handler:t};return r.callbacks.push(o),n}catch(e){return new h.InternalError("Library.EventSystem().register()",e)}},r.unregister=function(n){try{if("number"!=typeof n)throw"id should be a number.";var o=null;if(r.callbacks.forEach(function(e,t){o||e.id===n&&(o=t)}),null===o)throw"Could not find listener for id: "+n;return!!r.callbacks.splice(o,1)}catch(e){return new h.InternalError("Library.EventSystem().unregister()",e)}},r.unregisterAll=function(){r.callbacks=[]}},ViewOptions:function(e,t,n){try{if(t=t||{},!y.isDOMElement(e))throw"elm is not a DOM element.";if("object"!=typeof t||Array.isArray(t))throw"options exists, but is not an object.";if("number"!=typeof t.x&&t.x)throw'"options.x" exists, but is not a number.';if("number"!=typeof t.y&&t.y)throw'"options.y" exists, but is not a number.';if("number"==typeof t.x&&(t.x<0||1<t.x))throw'"options.x" must be a number between 0 and 1.';if("number"==typeof t.y&&(t.y<0||1<t.y))throw'"options.y" must be a number between 0 and 1.';return"number"!=typeof t.x&&(t.x=.5),"number"!=typeof t.y&&(t.y=.5),{elm:e,x:t.x,y:t.y}}catch(e){n(e)}},EditOptions:function(e,t,n){try{if(t=t||{},!y.isDOMElement(e))throw"element is not a DOM element.";if("object"!=typeof t||Array.isArray(t))throw"options exists, but is not an object.";if(void 0!==t.x&&"number"!=typeof t.x)throw"options.x exists, but is not a number.";if(void 0!==t.y&&"number"!=typeof t.y)throw"options.y exists, but is not a number.";if("number"==typeof t.x&&(t.x<0||1<t.x))throw"options.x must be a number between 0 and 1.";if("number"==typeof t.y&&(t.y<0||1<t.y))throw"options.y must be a number between 0 and 1.";if(void 0!==t.view_elm&&Array.isArray(t.view_elm)&&!y.areDOMElements(t.view_elm))throw"options.view_elm is an array, but not all items are elements.";if(!(void 0===t.view_elm||Array.isArray(t.view_elm)||"object"==typeof t.view_elm&&y.isDOMElement(t.view_elm)))throw"options.view_elm is given, but is not a DOM element.";if(void 0!==t.button_elm&&!y.isDOMElement(t.button_elm))throw"options.button_elm is given, but is not a DOM element.";if(void 0!==t.hide_cursor&&"boolean"!=typeof t.hide_cursor)throw"options.hide_cursor exists, but is not a boolean.";if(void 0!==t.no_cursor_class&&"string"!=typeof t.no_cursor_class)throw"options.no_cursor_class exists, but is not a string.";if("number"!=typeof t.x&&(t.x=.5),"number"!=typeof t.y&&(t.y=.5),!t.button_elm){var o=e.querySelector(".lfy-focuspoint-button");if(!y.isDOMElement(o))throw'options.button_elm is not given, and could not find a button with class "lfy-focuspoint-button" as fallback';t.button_elm=o}return"boolean"!=typeof t.hide_cursor&&(t.hide_cursor=!0),"string"!=typeof t.no_cursor_class&&(t.no_cursor_class="lfy-focuspoint-edit-hidecursor"),{elm:e,view_elm:t.view_elm,button_elm:t.button_elm,hide_cursor:t.hide_cursor,no_cursor_class:t.no_cursor_class,x:t.x,y:t.y}}catch(e){n(e)}}};e.Focuspoint={View:function(e,t){var n=new h.ViewOptions(e,t,function(e){new h.ApiError("Focuspoint.View()",e)}),t=new h.Current(n.x,n.y),o=(y.setBackgroundPositionToElm(n.elm,t.x,t.y),!1),r=this;r.current=t,r.set=function(e,t){try{if(o)throw"this Focuspoint.View has been killed";if("number"!=typeof e)throw"the given x coordinate is not a number";if("number"!=typeof t)throw"the given y coordinate is not a number";if(e<0||1<e)throw"the x coordinate must be a number between 0 and 1";if(t<0||1<t)throw"the y coordinate must be a number between 0 and 1";y.setBackgroundPositionToElm(n.elm,e,t).error||(r.current.x=e,r.current.y=t)}catch(e){return new h.ApiError("Focuspoint.View().set()",e)}},r.kill=function(){try{if(o)throw"this Focuspoint.View has already been killed";o=!0,delete r.current}catch(e){return new h.ApiError("Focuspoint.View().kill()",e)}}},Edit:function(e,t){var n=new h.EditOptions(e,t,function(e){new h.ApiError("Focuspoint.Edit()",e)}),o=new h.EventSystem,t=new h.Current(n.x,n.y),r=y.initializeDrag(n.elm,n.button_elm,t,o,n.hide_cursor,n.no_cursor_class);n.view_elm&&y.attachViews(n.view_elm,t,o.register);y.attachButton(n.button_elm,t,o.register);var i=!1,s=this;s.current=t,s.set=function(e,t){try{if(i)throw"this Focuspoint.Edit has been killed";if("number"!=typeof e)throw"the given x coordinate is not a number";if("number"!=typeof t)throw"the given y coordinate is not a number";if(e<0||1<e)throw"the x coordinate must be a number between 0 and 1";if(t<0||1<t)throw"the y coordinate must be a number between 0 and 1";y.setPositionToButtonElement(n.button_elm,e,t).error||(s.current.x=e,s.current.y=t),o.applyEvent("change",[s.current.x,s.current.y])}catch(e){return new h.ApiError("Focuspoint.Edit().set()",e)}},s.on=function(e,t){try{if(i)throw"this Focuspoint.Edit has been killed";if("string"!=typeof e)throw"event is not a string";if("function"!=typeof t)throw"handler is not a function";if(-1===o.possibleEvents.indexOf(e))throw'event "'+e+'" does not exist';o.register(e,t)}catch(e){return new h.ApiError("Focuspoint.Edit().on()",e)}},s.off=function(e){try{if(i)throw"this Focuspoint.Edit has been killed";if("number"!=typeof e)throw"id is not a number";o.unregister(e)}catch(e){return new h.ApiError("Focuspoint.Edit().off()",e)}},s.kill=function(){try{if(i)throw"this Focuspoint.Edit has already been killed";o.unregisterAll(),r(),i=!0,delete s.current}catch(e){return new h.ApiError("Focuspoint.Edit().kill()",e)}}}}}(window);